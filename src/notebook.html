<head>
    <link rel="stylesheet" href="style.css"></link>
    <link rel="stylesheet" href="fonts.css"></link>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.min.js"></script>
</head>
<body onkeydown="handlekey(event)">
    <header>
        <svg xmlns="http://www.w3.org/2000/svg" style="color: #555; -webkit-app-region: no-drag;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-panel-left" onclick="$('#editor-sidebar').toggle()"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 3v18"/></svg>
        <img src="logo.png" style="height: 30px; width: 30px; margin-right: 15px; margin-left: 15px;"></img>
        <div class="headertext">LocalNote: <div style="display: inline;" class="headerdoctext">notebookname</div></div>
        <input class="searchbox" placeholder="Search This Notebook, actions" id="notebooksearch"></input>
    </header>
    <div style="display: flex; place-items: center; flex-direction: row; width: 100vw; height: calc(100vh - 60px); margin-top: 60px; ">
        <div id="editor-sidebar">
            <div class="sectionheader">System</div>
            <div class="sidemenuitem">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cog"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"/><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"/><path d="M12 2v2"/><path d="M12 22v-2"/><path d="m17 20.66-1-1.73"/><path d="M11 10.27 7 3.34"/><path d="m20.66 17-1.73-1"/><path d="m3.34 7 1.73 1"/><path d="M14 12h8"/><path d="M2 12h2"/><path d="m20.66 7-1.73 1"/><path d="m3.34 17 1.73-1"/><path d="m17 3.34-1 1.73"/><path d="m11 13.73-4 6.93"/></svg>
                <div style="margin-left: 10px;">Settings</div>
            </div>
            <div class="sidemenuitem">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bookmark"><path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/></svg>
                <div style="margin-left: 10px;">Bookmarks</div>
            </div>
            <div style="height: 20px;"></div>
            <div class="sectionheader">Pages</div>
            <div class="sidemenuitem sidemenuitemsel">
                <div>üêà</div>
                <div style="margin-left: 10px;">Page 1</div>
            </div>
            <div class="sidemenuitem">
                <div>üòÑ</div>
                <div style="margin-left: 10px;">Page 2</div>
            </div>
        </div>
        <div id="movetestlist">
            <div class="nblock"><div class="blockhandle"></div><h1 placeholder="Press / to insert content" contenteditable class="editbox">LocalNote</h1></div>
            <div class="nblock"><div class="blockhandle"></div><p placeholder="Press / to insert content" contenteditable class="editbox">This is LocalNote, a simple note-taking application that can run fully in the web browser (or the electron app).</p></div>
            <div class="nblock"><div class="blockhandle"></div><h3 placeholder="Press / to insert content" contenteditable class="editbox">benefits</h3></div>
            <div class="nblock"><div class="blockhandle"></div><ul class="nblockul"><li placeholder="Press / to insert content" contenteditable class="editbox">fully local file saving</li></ul></div>
            <div class="nblock"><div class="blockhandle"></div><ul class="nblockul"><li placeholder="Press / to insert content" contenteditable class="editbox">Simple, Block-Based Editor</li></ul></div>
        </div>
    </div>
    <script>
        var handlekey = function(ev) {
            activeelm = document.activeElement
            setTimeout(() => {
                if (document.activeElement.innerHTML == "<br>") {
                    document.activeElement.innerHTML = ""
                }
                if (activeelm.innerHTML == "/" && activeelm.classList.contains("editbox")) {
                    document.getElementById("notebooksearch").focus()
                    $(".markedhandle").removeClass("markedhandle")
                    $("#notebooksearch").val("!insert ");
                    console.log($(activeelm).parents(".nblock").find(".blockhandle"))
                    $(activeelm).parents(".nblock").find(".blockhandle").addClass("markedhandle")
                }
            }, 10);
            if (ev.ctrlKey == true && ev.key == " ") {
                document.getElementById("notebooksearch").focus()
                $(".markedhandle").removeClass("markedhandle")
                console.log($(activeelm).parents(".nblock").find(".blockhandle"))
                $(activeelm).parents(".nblock").find(".blockhandle").addClass("markedhandle")
            } else if (ev.key == "Backspace" && document.activeElement.classList.contains("editbox")) {
                if (document.activeElement.innerHTML == "") {
                    ev.preventDefault()
                    console.log($(activeelm).parents(".nblock"))
                    $(activeelm).parents(".nblock").prev(".nblock").find(".editbox").focus()
                    $(activeelm).parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                }
            } else if (ev.key == "Enter" && document.activeElement.classList.contains("editbox")) {
                ev.preventDefault()
                $(activeelm).parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><p placeholder="Press / to insert content" contenteditable class="editbox"></p></div>')
                $(activeelm).parents(".nblock").next(".nblock").find(".editbox").focus()
                $(".markedhandle").removeClass("markedhandle")
            } else if (document.activeElement.classList.contains("editbox")) {
                $(".markedhandle").removeClass("markedhandle")
            } else if (ev.key == "Enter" && document.activeElement.classList.contains("searchbox")) {
                ev.preventDefault()
                console.log($(document.activeElement).val())
                if ($(document.activeElement).val() == "!insert h1") {
                    $(document.activeElement).val("")
                    $(".markedhandle").parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><h1 placeholder="Press / to insert content" contenteditable class="editbox"></h1></div>')
                    $(".markedhandle").parents(".nblock").next(".nblock").find(".editbox").focus()
                    $(".markedhandle").parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                } else if ($(document.activeElement).val() == "!insert p") {
                    $(document.activeElement).val("")
                    $(".markedhandle").parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><p placeholder="Press / to insert content" contenteditable class="editbox"></p></div>')
                    $(".markedhandle").parents(".nblock").next(".nblock").find(".editbox").focus()
                    $(".markedhandle").parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                } else if ($(document.activeElement).val() == "!insert li") {
                    $(document.activeElement).val("")
                    $(".markedhandle").parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><ul class="nblockul"><li placeholder="Press / to insert content" contenteditable class="editbox"></li></ul></div>')
                    $(".markedhandle").parents(".nblock").next(".nblock").find(".editbox").focus()
                    $(".markedhandle").parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                } else if ($(document.activeElement).val() == "!insert h2") {
                    $(document.activeElement).val("")
                    $(".markedhandle").parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><h2 placeholder="Press / to insert content" contenteditable class="editbox"></h2></div>')
                    $(".markedhandle").parents(".nblock").next(".nblock").find(".editbox").focus()
                    $(".markedhandle").parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                } else if ($(document.activeElement).val() == "!insert h3") {
                    $(document.activeElement).val("")
                    $(".markedhandle").parents(".nblock").after('<div class="nblock"><div class="blockhandle"></div><h3 placeholder="Press / to insert content" contenteditable class="editbox"></h3></div>')
                    $(".markedhandle").parents(".nblock").next(".nblock").find(".editbox").focus()
                    $(".markedhandle").parents(".nblock").remove()
                    $(".markedhandle").removeClass("markedhandle")
                }
            }
            console.log(document.activeElement)
            activeelm = document.activeElement
        } 
        $( function() {
            $( "#movetestlist" ).sortable({
                handle: ".blockhandle"
            });
        } );
        if (window.origin == "file://") {
            console.log("electron")
            $("#notebooksearch").css("margin-right", "175px")
        }
    </script>
</body>